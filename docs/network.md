

```markdown
# ðŸŒ Rubingo - Network Architecture

> Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø´Ø¨Ú©Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Rubingo

---

## ðŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

- [Ù…Ø¹Ø±ÙÛŒ](#-Ù…Ø¹Ø±ÙÛŒ)
- [Ø´Ø±ÙˆØ¹ Ú©Ø§Ø±](#-Ø´Ø±ÙˆØ¹-Ú©Ø§Ø±)
- [Ù…Ø¯ÛŒØ±ÛŒØª URL Ù‡Ø§](#-Ù…Ø¯ÛŒØ±ÛŒØª-url-Ù‡Ø§)
  - [ÙØ§ÛŒÙ„ Ú©Ø´ JSON](#ÙØ§ÛŒÙ„-Ú©Ø´-json)
  - [URL Manager Ù…Ø´ØªØ±Ú©](#url-manager-Ù…Ø´ØªØ±Ú©)
  - [Ù‚ÙÙ„â€ŒÙ‡Ø§ Ùˆ Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ](#Ù‚ÙÙ„â€ŒÙ‡Ø§-Ùˆ-Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ)
  - [ÙˆÙ‚ØªÛŒ URL Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯](#ÙˆÙ‚ØªÛŒ-url-Ú©Ø§Ø±-Ù†Ù…ÛŒÚ©Ù†Ø¯)
- [WebSocket](#-websocket)
  - [Ø§ØªØµØ§Ù„ Ùˆ Handshake](#Ø§ØªØµØ§Ù„-Ùˆ-handshake)
  - [Reconnect Ø®ÙˆØ¯Ú©Ø§Ø±](#reconnect-Ø®ÙˆØ¯Ú©Ø§Ø±)
  - [Keep-Alive](#keep-alive)
- [Ù¾Ø±ÙˆÚ©Ø³ÛŒ](#-Ù¾Ø±ÙˆÚ©Ø³ÛŒ)
  - [ØªÙ†Ø¸ÛŒÙ… Ù¾Ø±ÙˆÚ©Ø³ÛŒ](#ØªÙ†Ø¸ÛŒÙ…-Ù¾Ø±ÙˆÚ©Ø³ÛŒ)
  - [Ø§Ø³ØªØ«Ù†Ø§ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„ÛŒØ§Øª](#Ø§Ø³ØªØ«Ù†Ø§-Ú©Ø±Ø¯Ù†-Ø¹Ù…Ù„ÛŒØ§Øª)
  - [ØªØºÛŒÛŒØ± Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§](#ØªØºÛŒÛŒØ±-Ø¯Ø±-Ø²Ù…Ø§Ù†-Ø§Ø¬Ø±Ø§)
- [Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯](#-Ø¢Ù¾Ù„ÙˆØ¯-Ùˆ-Ø¯Ø§Ù†Ù„ÙˆØ¯)
- [Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ù„ÛŒ](#-Ù†Ù…ÙˆØ¯Ø§Ø±-Ú©Ù„ÛŒ)

---

## ðŸŽ¯ Ù…Ø¹Ø±ÙÛŒ

Rubingo ÛŒÚ© Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Go Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ API Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø§Ø³Øª. Ø§ÛŒÙ† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø´Ø§Ù…Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ URLØŒ Ø§ØªØµØ§Ù„ WebSocket Ø¨Ø§ reconnect Ø®ÙˆØ¯Ú©Ø§Ø±ØŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø¨Ú©Ù†Ø¯ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ Ø§Ø³Øª.

---

## ðŸš€ Ø´Ø±ÙˆØ¹ Ú©Ø§Ø±

### Ù†ØµØ¨

```bash
go get github.com/yourname/rubingo
```

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø³Ø§Ø¯Ù‡

```go
package main

import (
    "log"
    "rubingo"
)

func main() {
    client, err := rubingo.NewClient("my_bot")
    if err != nil {
        log.Fatal(err)
    }

    if err := client.Connect(); err != nil {
        log.Fatal(err)
    }

    if err := client.Start(""); err != nil {
        log.Fatal(err)
    }

    client.OnMessage(func(u *rubingo.Update) {
        log.Printf("Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯: %s", u.Text())
    })

    client.Run()
}
```

---

## ðŸ”— Ù…Ø¯ÛŒØ±ÛŒØª URL Ù‡Ø§

Ø±ÙˆØ¨ÛŒÚ©Ø§ Ú†Ù†Ø¯ÛŒÙ† Ø³Ø±ÙˆØ± Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ API Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ùˆ Ø¢Ø¯Ø±Ø³ Ø¯Ø§Ø±ÛŒÙ…:

| Ù†ÙˆØ¹ | Ú©Ø§Ø±Ø¨Ø±Ø¯ | Ù…Ø«Ø§Ù„ |
|-----|--------|------|
| **API URL** | Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ API | `https://messengerg2c65.iranlms.ir/` |
| **WSS URL** | Ø§ØªØµØ§Ù„ WebSocket Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ | `wss://jsocket3.iranlms.ir` |

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙÚ©Ø± Ú©Ù† Ø±ÙˆØ¨ÛŒÚ©Ø§ Ú†Ù†Ø¯ÛŒÙ† Ø¯ÙØªØ± Ø¯Ø§Ø±Ø¯. Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø¯Ø§Ù†ÛŒÙ… Ø¢Ø¯Ø±Ø³ Ú©Ø¯Ø§Ù… Ø¯ÙØªØ± Ø±Ø§ Ø¯Ø§Ø±ÛŒÙ….
> API URL Ø¢Ø¯Ø±Ø³ Ø¯ÙØªØ±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒÙ….
> WSS URL Ø¢Ø¯Ø±Ø³ Ø¯ÙØªØ±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù…Ù†ØªØ¸Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†ÛŒÙ… ØªØ§ Ù†Ø§Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø³Ø¯.

---

### ÙØ§ÛŒÙ„ Ú©Ø´ JSON

Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù†ÛŒØ§Ø²ÛŒ Ù†ÛŒØ³Øª Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø¢Ø¯Ø±Ø³ Ø¨Ú¯ÛŒØ±ÛŒÙ…. Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¯Ø± ÙØ§ÛŒÙ„ `rubika_urls.json` Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯:

```json
{
  "url": "https://messengerg2c65.iranlms.ir/",
  "wss_url": "wss://jsocket3.iranlms.ir",
  "updated_at": "2025-01-15T10:30:45+03:30"
}
```

#### Ù†Ø­ÙˆÙ‡ Ø®ÙˆØ§Ù†Ø¯Ù† Ùˆ Ù†ÙˆØ´ØªÙ† ÙØ§ÛŒÙ„

**Ø®ÙˆØ§Ù†Ø¯Ù†:** ØªØ§Ø¨Ø¹ `loadCachedURL` ÙØ§ÛŒÙ„ JSON Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯. Ø§Ú¯Ø± ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨ÙˆØ¯ ÛŒØ§ Ø®Ø±Ø§Ø¨ Ø¨ÙˆØ¯ØŒ Ø®Ø·Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯.

**Ù†ÙˆØ´ØªÙ†:** ØªØ§Ø¨Ø¹ `saveCachedURL` Ø¨Ø§ Ø±ÙˆØ´ **Atomic Write** ÙØ§ÛŒÙ„ Ø±Ø§ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯:

```
Û±. Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø¯Ø± ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯ (Ù…Ø«Ù„Ø§Ù‹ rubika_urls.json.tmp.1234567)
Û². ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª Ø±Ø§ Ø¨Ù‡ Ø§Ø³Ù… Ø§ØµÙ„ÛŒ ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ (rename)
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙØ±Ø¶ Ú©Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ ÛŒÚ© Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø¹ÙˆØ¶ Ú©Ù†ÛŒ. Ø§Ú¯Ø± Ù…Ø³ØªÙ‚ÛŒÙ… Ø±ÙˆÛŒ Ù†Ø§Ù…Ù‡ Ø¨Ù†ÙˆÛŒØ³ÛŒ Ùˆ 
> Ù‡Ù…Ø§Ù† Ù„Ø­Ø¸Ù‡ Ø¨Ø±Ù‚ Ø¨Ø±ÙˆØ¯ØŒ Ù†Ø§Ù…Ù‡ Ø®Ø±Ø§Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯. ÙˆÙ„ÛŒ Ø§Ú¯Ø± Ø§ÙˆÙ„ Ø±ÙˆÛŒ Ú©Ø§ØºØ° Ø¯ÛŒÚ¯Ø±ÛŒ 
> Ø¨Ù†ÙˆÛŒØ³ÛŒ Ùˆ Ø¨Ø¹Ø¯ Ú©Ø§ØºØ° Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ø§ Ú©Ø§ØºØ° Ø¬Ø¯ÛŒØ¯ Ø¹ÙˆØ¶ Ú©Ù†ÛŒØŒ Ù‡ÛŒÚ†ÙˆÙ‚Øª Ø®Ø±Ø§Ø¨ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
> Atomic Write Ù‡Ù…ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

#### ØªÙ†Ø¸ÛŒÙ… ÙØ§ÛŒÙ„ Ú©Ø´ Ø³ÙØ§Ø±Ø´ÛŒ

```go
// Ù‡Ø± Ø±Ø¨Ø§Øª ÙØ§ÛŒÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
client1, _ := rubingo.NewClient("bot1",
    rubingo.WithURLCacheFile("bot1_urls.json"),
)

client2, _ := rubingo.NewClient("bot2",
    rubingo.WithURLCacheFile("bot2_urls.json"),
)
```

---

### URL Manager Ù…Ø´ØªØ±Ú©

ÙˆÙ‚ØªÛŒ Ú†Ù†Ø¯ÛŒÙ† client Ù‡Ù…Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¯Ø± Ø¨Ú©Ù†Ø¯ ÛŒÚ© Ø³Ø§ÛŒØª)ØŒ Ù‡Ù…Ù‡ Ø§Ø² ÛŒÚ© **URL Manager Ù…Ø´ØªØ±Ú©** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯:

```go
var globalURLManager = &URLManager{}
```

Ø§ÛŒÙ† Ù…ØªØºÛŒØ± Ø¯Ø± Ø³Ø·Ø­ Ù¾Ú©ÛŒØ¬ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡. ÛŒØ¹Ù†ÛŒ ÙÙ‚Ø· **ÛŒÚ© Ø¯Ø§Ù†Ù‡** Ø¨Ø±Ø§ÛŒ Ú©Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ùˆ Ù‡Ù…Ù‡ client Ù‡Ø§ Ø§Ø² Ù‡Ù…ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.

#### URL Manager Ú†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¯Ø§Ø±Ø¯ØŸ

```go
type URLManager struct {
    mu        sync.RWMutex  // Ù‚ÙÙ„ Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†
    apiURL    string        // Ø¢Ø¯Ø±Ø³ API Ø¯Ø± RAM
    wssURL    string        // Ø¢Ø¯Ø±Ø³ WSS Ø¯Ø± RAM
    refreshMu sync.Mutex    // Ù‚ÙÙ„ refresh
}
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> URL Manager Ù…Ø«Ù„ ÛŒÚ© ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø´ØªØ±Ú© Ø§Ø³Øª. Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ø±ÙˆÛŒ ØªØ§Ø¨Ù„Ùˆ 
> Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡. Ù‡Ù…Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯. ÙˆÙ‚ØªÛŒ Ø¢Ø¯Ø±Ø³ Ø®Ø±Ø§Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ ÙÙ‚Ø· ÛŒÚ© 
> Ù†ÙØ± Ù…ÛŒâ€ŒØ±ÙˆØ¯ Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ Ø¨Ú¯ÛŒØ±Ø¯ Ùˆ Ø±ÙˆÛŒ ØªØ§Ø¨Ù„Ùˆ Ø¨Ù†ÙˆÛŒØ³Ø¯. Ø¨Ù‚ÛŒÙ‡ Ø§Ø² Ù‡Ù…Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.

---

### Ù‚ÙÙ„â€ŒÙ‡Ø§ Ùˆ Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ

Ø¯Ùˆ Ù†ÙˆØ¹ Ù‚ÙÙ„ Ø¯Ø§Ø±ÛŒÙ…:

#### Û±. Ù‚ÙÙ„ Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ† (`mu` - `sync.RWMutex`)

Ø§ÛŒÙ† Ù‚ÙÙ„ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø§Ø² `apiURL` Ùˆ `wssURL` Ø¯Ø± RAM Ø§Ø³Øª.

**Ú†Ø±Ø§ Ù„Ø§Ø²Ù… Ø§Ø³ØªØŸ** ÙØ±Ø¶ Ú©Ù† ÛŒÚ© Ù†ÙØ± Ø¯Ø§Ø±Ø¯ Ù‡Ø± Ø¯Ùˆ URL Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. `apiURL` Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù†ÙˆØ´ØªÙ‡ ÙˆÙ„ÛŒ Ù‡Ù†ÙˆØ² `wssURL` Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù†Ù†ÙˆØ´ØªÙ‡. Ù‡Ù…Ø§Ù† Ù„Ø­Ø¸Ù‡ ÛŒÚ© Ù†ÙØ± Ø¯ÛŒÚ¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯. `apiURL` Ø¬Ø¯ÛŒØ¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ ÙˆÙ„ÛŒ `wssURL` Ù‚Ø¯ÛŒÙ…ÛŒ. Ø§ÛŒÙ† Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.

**Ù‚ÙÙ„ Ø®ÙˆØ§Ù†Ø¯Ù† (`RLock`):** Ú†Ù†Ø¯ Ù†ÙØ± Ù‡Ù…Ø²Ù…Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯. ÙˆÙ„ÛŒ ØªØ§ ÙˆÙ‚ØªÛŒ Ú©Ø³ÛŒ Ø¯Ø§Ø±Ø¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯ØŒ Ú©Ø³ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù†ÙˆÛŒØ³Ø¯.

**Ù‚ÙÙ„ Ù†ÙˆØ´ØªÙ† (`Lock`):** ÙÙ‚Ø· ÛŒÚ© Ù†ÙØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù†ÙˆÛŒØ³Ø¯. ØªØ§ ÙˆÙ‚ØªÛŒ Ù†ÙˆØ´ØªÙ† ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ØŒ Ú©Ø³ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø®ÙˆØ§Ù†Ø¯ ÛŒØ§ Ø¨Ù†ÙˆÛŒØ³Ø¯.

```
Ø®ÙˆØ§Ù†Ø¯Ù† Ù‡Ù…Ø²Ù…Ø§Ù†:
  Ù†ÙØ± A â”€â”€â–¶ RLock â”€â”€â–¶ Ø®ÙˆØ§Ù†Ø¯Ù† â”€â”€â–¶ RUnlock    âœ… Ù‡Ù…Ø²Ù…Ø§Ù†
  Ù†ÙØ± B â”€â”€â–¶ RLock â”€â”€â–¶ Ø®ÙˆØ§Ù†Ø¯Ù† â”€â”€â–¶ RUnlock    âœ… Ù‡Ù…Ø²Ù…Ø§Ù†
  Ù†ÙØ± C â”€â”€â–¶ RLock â”€â”€â–¶ Ø®ÙˆØ§Ù†Ø¯Ù† â”€â”€â–¶ RUnlock    âœ… Ù‡Ù…Ø²Ù…Ø§Ù†

Ù†ÙˆØ´ØªÙ†:
  Ù†ÙØ± D â”€â”€â–¶ Lock â”€â”€â–¶ Ù†ÙˆØ´ØªÙ† â”€â”€â–¶ Unlock
  Ù†ÙØ± E â”€â”€â–¶ ØµØ¨Ø±... â”€â”€â–¶ RLock â”€â”€â–¶ Ø®ÙˆØ§Ù†Ø¯Ù†    â³ ØµØ¨Ø± ØªØ§ Ù†ÙˆØ´ØªÙ† ØªÙ…Ø§Ù… Ø´ÙˆØ¯
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> Ù‚ÙÙ„ Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø«Ù„ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§Ø³Øª. Ú†Ù†Ø¯ Ù†ÙØ± Ù‡Ù…Ø²Ù…Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ú©ØªØ§Ø¨ 
> Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯. ÙˆÙ„ÛŒ ÙˆÙ‚ØªÛŒ Ú©ØªØ§Ø¨Ø¯Ø§Ø± Ø¯Ø§Ø±Ø¯ Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯ Ù‚ÙØ³Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø¨Ø§ÛŒØ¯ 
> ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ØªØ§ Ú©Ø§Ø±Ø´ ØªÙ…Ø§Ù… Ø´ÙˆØ¯. ÙˆÚ¯Ø±Ù†Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©ØªØ§Ø¨ Ù†ØµÙÙ‡â€ŒÚ©Ø§Ø±Ù‡ Ø¨Ø±Ø¯Ø§Ø±ÛŒØ¯.

#### Û². Ù‚ÙÙ„ refresh (`refreshMu` - `sync.Mutex`)

Ø§ÛŒÙ† Ù‚ÙÙ„ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ú†Ù†Ø¯ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø§Ø³Øª.

**Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ† Ù‚ÙÙ„:** Ø§Ú¯Ø± Û±Û°Û° Ú©Ø§Ø±Ø¨Ø± Ù‡Ù…Ø²Ù…Ø§Ù† Ù„Ø§Ú¯ÛŒÙ† Ú©Ù†Ù†Ø¯ Ùˆ URL Ú©Ø§Ø± Ù†Ú©Ù†Ø¯ØŒ Û±Û°Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§ ÙØ±Ø³ØªØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨ÛŒØ®ÙˆØ¯ÛŒ!

**Ø¨Ø§ Ø§ÛŒÙ† Ù‚ÙÙ„:** ÙÙ‚Ø· Ù†ÙØ± Ø§ÙˆÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÛŒâ€ŒÙØ±Ø³ØªØ¯. Û¹Û¹ Ù†ÙØ± Ø¯ÛŒÚ¯Ø± ØµØ¨Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ Ùˆ Ø§Ø² Ù†ØªÛŒØ¬Ù‡ Ù‡Ù…Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.

```
Ø¨Ø¯ÙˆÙ† Ù‚ÙÙ„ refresh:
  Ú©Ø§Ø±Ø¨Ø± A â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§
  Ú©Ø§Ø±Ø¨Ø± B â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§  (ØªÚ©Ø±Ø§Ø±ÛŒ!)
  Ú©Ø§Ø±Ø¨Ø± C â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§  (ØªÚ©Ø±Ø§Ø±ÛŒ!)

Ø¨Ø§ Ù‚ÙÙ„ refresh:
  Ú©Ø§Ø±Ø¨Ø± A â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ Ù‚ÙÙ„ â”€â”€â–¶ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§ â”€â”€â–¶ Ø°Ø®ÛŒØ±Ù‡ â”€â”€â–¶ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù‚ÙÙ„
  Ú©Ø§Ø±Ø¨Ø± B â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ ØµØ¨Ø±... â”€â”€â–¶ URL Ø¹ÙˆØ¶ Ø´Ø¯Ù‡ØŸ Ø¨Ù„Ù‡ â”€â”€â–¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ âœ…
  Ú©Ø§Ø±Ø¨Ø± C â”€â”€â–¶ URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ ØµØ¨Ø±... â”€â”€â–¶ URL Ø¹ÙˆØ¶ Ø´Ø¯Ù‡ØŸ Ø¨Ù„Ù‡ â”€â”€â–¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ âœ…
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙØ±Ø¶ Ú©Ù† Û±Û° Ù†ÙØ± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯ ØºØ°Ø§ Ø³ÙØ§Ø±Ø´ Ø¨Ø¯Ù‡Ù†Ø¯. Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù‡Ø± Û±Û° Ù†ÙØ± 
> Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø²Ù†Ú¯ Ø¨Ø²Ù†Ù†Ø¯ØŒ ÛŒÚ© Ù†ÙØ± Ø²Ù†Ú¯ Ù…ÛŒâ€ŒØ²Ù†Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø³ÙØ§Ø±Ø´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
> Ù‚ÙÙ„ refresh Ù‡Ù…ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

---

### ÙˆÙ‚ØªÛŒ URL Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Ø³Ù†Ø§Ø±ÛŒÙˆ Û±: URL Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø± Ø®Ø§Ù„ÛŒ Ø§Ø³Øª

```
Û±. GetURLs ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Û². RAM Ø®Ø§Ù„ÛŒ Ø§Ø³Øª
Û³. ÙˆØ§Ø±Ø¯ refresh Ù…ÛŒâ€ŒØ´ÙˆØ¯
Û´. Ù‚ÙÙ„ refreshMu Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Ûµ. Ø¯ÙˆØ¨Ø§Ø±Ù‡ RAM Ú†Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø´Ø§ÛŒØ¯ ÛŒÚ©ÛŒ Ø¯ÛŒÚ¯Ù‡ Ù¾Ø± Ú©Ø±Ø¯Ù‡)
Û¶. ÙØ§ÛŒÙ„ JSON Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â”œâ”€â”€ ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯ â”€â”€â–¶ Ø§Ø² ÙØ§ÛŒÙ„ Ø¨Ø®ÙˆØ§Ù† â”€â”€â–¶ Ø¯Ø± RAM Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
   â””â”€â”€ ÙØ§ÛŒÙ„ Ù†ÛŒØ³Øª â”€â”€â–¶ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø¨Ú¯ÛŒØ± â”€â”€â–¶ Ø¯Ø± ÙØ§ÛŒÙ„ Ùˆ RAM Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
Û·. Ù‚ÙÙ„ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

#### Ø³Ù†Ø§Ø±ÛŒÙˆ Û²: API URL Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

```
Û±. Ø¯Ø±Ø®ÙˆØ§Ø³Øª API ÙØ±Ø³ØªØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Û². Ø®Ø·Ø§! URL Ø¬ÙˆØ§Ø¨ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
Û³. ForceRefresh ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ø§ URL ÙØ¹Ù„ÛŒ (oldURL)
Û´. Ù‚ÙÙ„ refreshMu Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Ûµ. URL ÙØ¹Ù„ÛŒ RAM Ø¨Ø§ oldURL Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â”œâ”€â”€ ÙØ±Ù‚ Ø¯Ø§Ø±Ø¯ â”€â”€â–¶ ÛŒÚ©ÛŒ Ø¯ÛŒÚ¯Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ú¯Ø±ÙØªÙ‡ â”€â”€â–¶ Ù‡Ù…ÛŒÙ† Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø± âœ…
   â””â”€â”€ ÙØ±Ù‚ Ù†Ø¯Ø§Ø±Ø¯ â”€â”€â–¶ ÙˆØ§Ù‚Ø¹Ø§Ù‹ Ø¨Ø§ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ú¯ÛŒØ±ÛŒÙ…
       â””â”€â”€ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø¨Ú¯ÛŒØ± â”€â”€â–¶ Ø¯Ø± ÙØ§ÛŒÙ„ Ùˆ RAM Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
Û¶. Ù‚ÙÙ„ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

#### Ø³Ù†Ø§Ø±ÛŒÙˆ Û³: WSS URL Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

```
Û±. Ø§ØªØµØ§Ù„ WebSocket Ù‚Ø·Ø¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Û². refreshWSSURL ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
Û³. Ø¯Ø§Ø®Ù„Ø´ ForceRefresh Ø±Ø§ ØµØ¯Ø§ Ù…ÛŒâ€ŒØ²Ù†Ø¯
Û´. Ù‡Ù…Ø§Ù† Ù…Ù†Ø·Ù‚ Ø³Ù†Ø§Ø±ÛŒÙˆ Û²
Ûµ. Ù‡Ø± Ø¯Ùˆ URL (API Ùˆ WSS) Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
Û¶. Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù‡ WSS Ø¬Ø¯ÛŒØ¯ ÙˆØµÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

#### Ø³Ù†Ø§Ø±ÛŒÙˆ Û´: Ú†Ù†Ø¯ Ù†ÙØ± Ù‡Ù…Ø²Ù…Ø§Ù† URL Ø®Ø±Ø§Ø¨ Ø¯Ø§Ø±Ù†Ø¯

```
Û±. Ù†ÙØ± A: URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ ForceRefresh(oldURL="server1")
   â””â”€â”€ Ù‚ÙÙ„ Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ø¯ â”€â”€â–¶ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ â”€â”€â–¶ RAM = "server2" â”€â”€â–¶ Ù‚ÙÙ„ Ø¨Ø§Ø²

Û². Ù†ÙØ± B: URL Ø®Ø±Ø§Ø¨ â”€â”€â–¶ ForceRefresh(oldURL="server1")
   â””â”€â”€ Ù‚ÙÙ„ Ø¨Ø§Ø² Ø´Ø¯ â”€â”€â–¶ ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â””â”€â”€ RAM = "server2" â‰  oldURL = "server1" â”€â”€â–¶ ÙØ±Ù‚ Ø¯Ø§Ø±Ø¯!
   â””â”€â”€ "server2" Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒØ¯Ø§Ø±Ø¯ Ùˆ Ù…ÛŒâ€ŒØ±ÙˆØ¯ âœ… (Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±ÙˆØ¨ÛŒÚ©Ø§ Ù†Ø²Ø¯)

Û³. Ù†ÙØ± C: Ù…Ø«Ù„ Ù†ÙØ± B âœ…
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙØ±Ø¶ Ú©Ù† Ø¢Ø¯Ø±Ø³ Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¹ÙˆØ¶ Ø´Ø¯Ù‡. Ù†ÙØ± Ø§ÙˆÙ„ Ù…ÛŒâ€ŒØ±ÙˆØ¯ Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
> Ùˆ Ø±ÙˆÛŒ ØªØ§Ø¨Ù„Ùˆ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯. Ø¨Ù‚ÛŒÙ‡ ÙˆÙ‚ØªÛŒ Ù…ÛŒâ€ŒØ¢ÛŒÙ†Ø¯ØŒ Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù†Ø¯ Ø¢Ø¯Ø±Ø³ Ø±ÙˆÛŒ ØªØ§Ø¨Ù„Ùˆ Ø¹ÙˆØ¶ 
> Ø´Ø¯Ù‡. Ù¾Ø³ Ø¯ÛŒÚ¯Ø± Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª Ø®ÙˆØ¯Ø´Ø§Ù† Ø¨Ø±ÙˆÙ†Ø¯ Ø¯Ù†Ø¨Ø§Ù„ Ø¢Ø¯Ø±Ø³. Ø§Ø² Ù‡Ù…Ø§Ù† ØªØ§Ø¨Ù„Ùˆ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ù†Ø¯.

---

## ðŸ”Œ WebSocket

### Ø§ØªØµØ§Ù„ Ùˆ Handshake

ÙˆÙ‚ØªÛŒ `client.Run()` ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ ØªØ§Ø¨Ø¹ `GetUpdates` Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

```
Û±. Ú†Ú© Ú©Ø±Ø¯Ù† WSS URL (Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ refresh Ù…ÛŒâ€ŒØ²Ù†Ø¯)
Û². Ø³Ø§Ø®Øª WebSocket Dialer (Ø¨Ø§ ÛŒØ§ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ)
Û³. Ø§ØªØµØ§Ù„ Ø¨Ù‡ WSS URL
Û´. Ø§Ø±Ø³Ø§Ù„ Handshake:
   {
     "method": "handShake",
     "auth": "ØªÙˆÚ©Ù† Ú©Ø§Ø±Ø¨Ø±",
     "api_version": "6",
     "data": ""
   }
Ûµ. Ø´Ø±ÙˆØ¹ Ø®ÙˆØ§Ù†Ø¯Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ø­Ù„Ù‚Ù‡ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª
```

### Reconnect Ø®ÙˆØ¯Ú©Ø§Ø±

Ø§Ú¯Ø± Ø§ØªØµØ§Ù„ WebSocket Ù‚Ø·Ø¹ Ø´ÙˆØ¯ØŒ Ø±Ø¨Ø§Øª Ø®Ø§Ù…ÙˆØ´ **Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯**:

```
Ø§ØªØµØ§Ù„ Ù‚Ø·Ø¹ Ø´Ø¯
    â”‚
    â–¼
Ø§ØªØµØ§Ù„ ÙØ¹Ù„ÛŒ Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    â”‚
    â–¼
refreshWSSURL ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (URL Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§)
    â”‚
    â–¼
Û³ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø±
    â”‚
    â–¼
Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§ØªØµØ§Ù„ Ø¨Ù‡ WSS Ø¬Ø¯ÛŒØ¯
    â”‚
    â–¼
Handshake Ø¯ÙˆØ¨Ø§Ø±Ù‡
    â”‚
    â–¼
Ø®ÙˆØ§Ù†Ø¯Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> Ù…Ø«Ù„ ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ†. Ø§Ú¯Ø± Ø¢Ù†ØªÙ† Ù‚Ø·Ø¹ Ø´ÙˆØ¯ØŒ ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ† Ø®Ø§Ù…ÙˆØ´ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
> ÙÙ‚Ø· Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢Ù†ØªÙ† Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### Keep-Alive

Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ© goroutine Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¯Ùˆ Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:

```
Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡:
  â”œâ”€â”€ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø§Ù„ÛŒ {} Ø¨Ù‡ Ø³Ø±ÙˆØ± (ØªØ§ Ø§ØªØµØ§Ù„ Ù‚Ø·Ø¹ Ù†Ø´ÙˆØ¯)
  â””â”€â”€ ØµØ¯Ø§ Ø²Ø¯Ù† GetChatsUpdates (ØªØ§ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ sync Ø´ÙˆÙ†Ø¯)
```

---

## ðŸ”’ Ù¾Ø±ÙˆÚ©Ø³ÛŒ

### ØªÙ†Ø¸ÛŒÙ… Ù¾Ø±ÙˆÚ©Ø³ÛŒ

```go
// Ø±ÙˆØ´ Û±: Ù‡Ù†Ú¯Ø§Ù… Ø³Ø§Ø®Øª client
client, _ := rubingo.NewClient("my_bot",
    rubingo.WithProxy("socks5://127.0.0.1:1080"),
    rubingo.WithProxyEnabled(true),
)

// Ø±ÙˆØ´ Û²: Ø¨Ø¹Ø¯ Ø§Ø² Ø³Ø§Ø®Øª client
client.SetProxy("http://user:pass@proxy.example.com:8080")
client.EnableProxy()
```

### Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡

| Ù¾Ø±ÙˆØªÚ©Ù„ | Ù…Ø«Ø§Ù„ |
|---------|------|
| HTTP | `http://proxy:8080` |
| HTTPS | `https://proxy:8443` |
| SOCKS5 | `socks5://proxy:1080` |
| Ø¨Ø§ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª | `socks5://user:pass@proxy:1080` |

### Ø§Ø³ØªØ«Ù†Ø§ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„ÛŒØ§Øª

Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ Ú©Ø¯Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øªâ€ŒÙ‡Ø§ **Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ** Ø§Ø¬Ø±Ø§ Ø´ÙˆÙ†Ø¯:

```go
// Ù‡Ù†Ú¯Ø§Ù… Ø³Ø§Ø®Øª client
client, _ := rubingo.NewClient("my_bot",
    rubingo.WithProxy("socks5://127.0.0.1:1080"),
    rubingo.WithProxyEnabled(true),
    rubingo.WithProxyExclude(
        rubingo.ProxyOpRefreshURL,  // Ú¯Ø±ÙØªÙ† URL Ø¬Ø¯ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ
        rubingo.ProxyOpGetDCs,      // Ú¯Ø±ÙØªÙ† Ù„ÛŒØ³Øª Ø³Ø±ÙˆØ±Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ
    ),
)

// ÛŒØ§ Ø¨Ø¹Ø¯Ø§Ù‹
client.ExcludeFromProxy(rubingo.ProxyOpUpload)    // Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ
client.IncludeInProxy(rubingo.ProxyOpUpload)       // Ø¢Ù¾Ù„ÙˆØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§ Ù¾Ø±ÙˆÚ©Ø³ÛŒ
```

#### Ø¹Ù…Ù„ÛŒØ§Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªØ«Ù†Ø§

| Ø«Ø§Ø¨Øª | Ø¹Ù…Ù„ÛŒØ§Øª |
|------|--------|
| `ProxyOpRefreshURL` | Ú¯Ø±ÙØªÙ† URL Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ |
| `ProxyOpGetDCs` | Ú¯Ø±ÙØªÙ† Ù„ÛŒØ³Øª Ø³Ø±ÙˆØ±Ù‡Ø§ |
| `ProxyOpAPI` | Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ API |
| `ProxyOpUpload` | Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ |
| `ProxyOpDownload` | Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ |
| `ProxyOpWebSocket` | Ø§ØªØµØ§Ù„ WebSocket |

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙØ±Ø¶ Ú©Ù† Ø§Ø² VPN Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ. ÙˆÙ„ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ø¹Ø¶ÛŒ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ Ù…Ø³ØªÙ‚ÛŒÙ… 
> Ø¨Ø§Ø² Ø´ÙˆÙ†Ø¯ Ù†Ù‡ Ø§Ø² VPN. Ø§Ø³ØªØ«Ù†Ø§ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„ÛŒØ§Øª Ù‡Ù…ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### Ø¯Ùˆ HTTP Client

Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¯Ùˆ HTTP Client Ø¯Ø§Ø±Ø¯:

```
httpClient   â”€â”€â–¶ Ø¨Ø§ Ù¾Ø±ÙˆÚ©Ø³ÛŒ (Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯)
directClient â”€â”€â–¶ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ
```

ÙˆÙ‚ØªÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ø³ØªØ«Ù†Ø§ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² `directClient` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª Ø§Ø² `httpClient`.

### ØªØºÛŒÛŒØ± Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§

```go
// ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†
client.EnableProxy()

// ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†
client.DisableProxy()

// ØªØºÛŒÛŒØ± Ø¢Ø¯Ø±Ø³ Ù¾Ø±ÙˆÚ©Ø³ÛŒ
client.SetProxy("socks5://new-proxy:1080")

// Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª
if client.IsProxyEnabled() {
    fmt.Println("Ù¾Ø±ÙˆÚ©Ø³ÛŒ ÙØ¹Ø§Ù„ Ø§Ø³Øª")
}
```

ØªØºÛŒÛŒØ± Ù¾Ø±ÙˆÚ©Ø³ÛŒ **thread-safe** Ø§Ø³Øª. ÛŒØ¹Ù†ÛŒ Ø­ØªÛŒ Ø§Ú¯Ø± Ù‡Ù…Ø§Ù† Ù„Ø­Ø¸Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§Ø´Ù†Ø¯ØŒ Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ù†Ù…ÛŒâ€ŒØ¢ÛŒØ¯.

---

## ðŸ“ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯

### Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„

```
Û±. RequestSendFile: Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø§Ø¬Ø§Ø²Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯
   â† file_id, upload_url, access_hash_send

Û². ÙØ§ÛŒÙ„ Ø¨Ù‡ Ù‚Ø·Ø¹Ø§Øª (chunk) ØªÙ‚Ø³ÛŒÙ… Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Û± Ù…Ú¯Ø§Ø¨Ø§ÛŒØª)

Û³. Ù‡Ø± Ù‚Ø·Ø¹Ù‡ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
   â”œâ”€â”€ Ù‡Ø¯Ø±Ù‡Ø§: auth, file-id, total-part, part-number, chunk-size
   â””â”€â”€ Ø¨Ø¯Ù†Ù‡: Ø¯Ø§Ø¯Ù‡ Ù‚Ø·Ø¹Ù‡

Û´. Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¨Ø®ÙˆØ±Ø¯ØŒ ØªØ§ Ûµ Ø¨Ø§Ø± retry Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø¨Ø§ ØªØ£Ø®ÛŒØ± Ù†Ù…Ø§ÛŒÛŒ)

Ûµ. Ø§Ú¯Ø± Ø³Ø±ÙˆØ± ERROR_TRY_AGAIN Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯:
   â””â”€â”€ RequestSendFile Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯

Û¶. Ù†ØªÛŒØ¬Ù‡: file_id, dc_id, access_hash_rec
```

### Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„

```
Û±. Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ø§Ø² dc_id Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
   https://messenger{dc_id}.iranlms.ir

Û². ÙØ§ÛŒÙ„ Ø¨Ù‡ Ù‚Ø·Ø¹Ø§Øª (chunk) Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Û±Û²Û¸ Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª)

Û³. Ù‡Ø± Ù‚Ø·Ø¹Ù‡ Ø¨Ø§ Ù‡Ø¯Ø±Ù‡Ø§ÛŒ start-index Ùˆ last-index Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯

Û´. Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¨Ø®ÙˆØ±Ø¯ØŒ ØªØ§ Ûµ Ø¨Ø§Ø± retry Ù…ÛŒâ€ŒÚ©Ù†Ø¯

Ûµ. Ù†ØªÛŒØ¬Ù‡: Ø¨Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙØ§ÛŒÙ„ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„
```

### Retry Ø¨Ø§ ØªØ£Ø®ÛŒØ± Ù†Ù…Ø§ÛŒÛŒ

```
ØªÙ„Ø§Ø´ Û±: ÙÙˆØ±ÛŒ
ØªÙ„Ø§Ø´ Û²: Û² Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø±
ØªÙ„Ø§Ø´ Û³: Û´ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø±
ØªÙ„Ø§Ø´ Û´: Û¸ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø±
ØªÙ„Ø§Ø´ Ûµ: Û±Û¶ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø±
```

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> ÙˆÙ‚ØªÛŒ Ø¨Ù‡ Ú©Ø³ÛŒ Ø²Ù†Ú¯ Ù…ÛŒâ€ŒØ²Ù†ÛŒ Ùˆ Ø¬ÙˆØ§Ø¨ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŒ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø²Ù†Ú¯ Ù†Ù…ÛŒâ€ŒØ²Ù†ÛŒ.
> Ø§ÙˆÙ„ Û² Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ Ø¨Ø¹Ø¯ Û´ Ø«Ø§Ù†ÛŒÙ‡ØŒ Ø¨Ø¹Ø¯ Û¸ Ø«Ø§Ù†ÛŒÙ‡. Ø§ÛŒÙ† ØªØ£Ø®ÛŒØ± Ù†Ù…Ø§ÛŒÛŒ Ø§Ø³Øª.
> Ø§Ú¯Ø± Ø³Ø±ÙˆØ± Ø´Ù„ÙˆØº Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ú©Ø§Ø± Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ÙØ´Ø§Ø± Ú©Ù…ØªØ±ÛŒ Ø¨ÛŒØ§ÙˆØ±ÛŒÙ….

---

## ðŸ—º Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ù„ÛŒ

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   client.Start()     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚      GetDCs()        â”‚
                         â”‚  globalURLManager    â”‚
                         â”‚    .GetURLs()        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  RAM Ù¾Ø± Ø§Ø³Øª  â”‚                â”‚  RAM Ø®Ø§Ù„ÛŒ Ø§Ø³Øª    â”‚
           â”‚  Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†  â”‚                â”‚  refresh ØµØ¯Ø§ Ø¨Ø²Ù† â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                 â”‚
                  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                    â–¼                         â–¼
                  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚           â”‚ ÙØ§ÛŒÙ„ JSON   â”‚         â”‚ ÙØ§ÛŒÙ„ JSON Ù†ÛŒØ³Øª  â”‚
                  â”‚           â”‚ Ø¨Ø®ÙˆØ§Ù†       â”‚         â”‚ Ø§Ø² Ø±ÙˆØ¨ÛŒÚ©Ø§ Ø¨Ú¯ÛŒØ±  â”‚
                  â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                  â”‚                          â”‚
                  â”‚                  â–¼                          â–¼
                  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚           â”‚ RAM Ø°Ø®ÛŒØ±Ù‡   â”‚         â”‚ RAM + JSON Ø°Ø®ÛŒØ±Ù‡â”‚
                  â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                  â”‚                          â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   client.Run()       â”‚
                         â”‚   GetUpdates()       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Ø§ØªØµØ§Ù„ Ø¨Ù‡ WSS URL   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â–¼                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Ù…ÙˆÙÙ‚ âœ…    â”‚   â”‚ Ù†Ø§Ù…ÙˆÙÙ‚ âŒ   â”‚
                    â”‚ Handshake  â”‚   â”‚ refresh +   â”‚
                    â”‚ Ø®ÙˆØ§Ù†Ø¯Ù†    â”‚   â”‚ Û³ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± â”‚
                    â”‚ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§   â”‚   â”‚ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Ø®Ù„Ø§ØµÙ‡ Ù…Ø¹Ù…Ø§Ø±ÛŒ

| Ø¬Ø²Ø¡ | ÙˆØ¸ÛŒÙÙ‡ |
|-----|-------|
| `globalURLManager` | Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´ØªØ±Ú© URL Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ client Ù‡Ø§ |
| `mu (RWMutex)` | Ù…Ø­Ø§ÙØ¸Øª Ø§Ø² Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ† URL Ø¯Ø± RAM |
| `refreshMu (Mutex)` | Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² refresh Ù‡Ù…Ø²Ù…Ø§Ù† Ú†Ù†Ø¯ Ù†ÙØ±Ù‡ |
| `saveCachedURL` | Ù†ÙˆØ´ØªÙ† Atomic ÙØ§ÛŒÙ„ JSON |
| `GetUpdates` | Ø­Ù„Ù‚Ù‡ Ø§ØµÙ„ÛŒ WebSocket Ø¨Ø§ reconnect Ø®ÙˆØ¯Ú©Ø§Ø± |
| `keepSocket` | Ø§Ø±Ø³Ø§Ù„ keep-alive Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡ |
| `httpClient` | Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù¾Ø±ÙˆÚ©Ø³ÛŒ |
| `directClient` | Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ (Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø³ØªØ«Ù†Ø§ Ø´Ø¯Ù‡) |
| `ForceRefresh` | Ú¯Ø±ÙØªÙ† URL Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ø³ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ú¯Ø±ÙØªÙ‡ |
| `exponentialBackoff` | ØªØ£Ø®ÛŒØ± Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ retry |

---

## âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶

| ØªÙ†Ø¸ÛŒÙ… | Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ |
|-------|--------------|
| Timeout | Û²Û° Ø«Ø§Ù†ÛŒÙ‡ |
| Max Retries | Ûµ |
| Upload Chunk Size | Û± Ù…Ú¯Ø§Ø¨Ø§ÛŒØª |
| Download Chunk Size | Û±Û²Û¸ Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª |
| Keep-Alive Interval | Û±Û° Ø«Ø§Ù†ÛŒÙ‡ |
| Reconnect Delay | Û³ Ø«Ø§Ù†ÛŒÙ‡ |
| URL Cache File | `rubika_urls.json` |
| API Version | `6` |

---

## ðŸ” Thread Safety

ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ **thread-safe** Ù‡Ø³ØªÙ†Ø¯:

| Ø¨Ø®Ø´ | Ø±ÙˆØ´ Ù…Ø­Ø§ÙØ¸Øª |
|-----|-----------|
| URL Ù‡Ø§ÛŒ RAM | `sync.RWMutex` |
| Refresh URL | `sync.Mutex` |
| WebSocket Connection | `sync.Mutex` |
| HTTP Client (Ù¾Ø±ÙˆÚ©Ø³ÛŒ) | `sync.RWMutex` |
| Handlers | `sync.RWMutex` |
| ÙØ§ÛŒÙ„ JSON | Atomic Write |

> **ðŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¯Ù‡:**
> 
> Thread-safe ÛŒØ¹Ù†ÛŒ Ø§Ú¯Ø± Û±Û°Û° Ù†ÙØ± Ù‡Ù…Ø²Ù…Ø§Ù† Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù†Ø¯ØŒ 
> Ù‡ÛŒÚ† Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ù†Ù…ÛŒâ€ŒØ¢ÛŒØ¯. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù‚Ø§Ø·ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ crash Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
> Ø§ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø¨Ú©Ù†Ø¯ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø²ÛŒØ§Ø¯ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ø§Ø±Ù†Ø¯ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù… Ø§Ø³Øª.
```